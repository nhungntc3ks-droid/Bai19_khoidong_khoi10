<!doctype html>
<html lang="vi" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrÃ² ChÆ¡i Há»c Python</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .game-container {
            background: #ffffff;
            position: relative;
            overflow: hidden;
        }
        
        .falling-decoration {
            position: absolute;
            font-size: 20px;
            opacity: 0.6;
            animation: fall linear infinite;
            pointer-events: none;
        }
        
        @keyframes fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .ball {
            position: absolute;
            border-radius: 50%;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            text-align: center;
            padding: 15px;
            word-break: break-word;
            transition: top 0.05s linear;
        }
        
        .ball-knot {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #666 0%, #333 100%);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
        }
        
        .basket {
            width: 140px;
            height: 100px;
            position: absolute;
            bottom: 150px;
            left: 30px;
            transform: translateX(0);
        }
        
        .basket-body {
            width: 100%;
            height: 70px;
            background: linear-gradient(to bottom, #8B4513 0%, #654321 100%);
            border-radius: 10px 10px 25px 25px;
            border: 2px solid #5a2a0a;
            position: relative;
        }
        
        .basket-handle {
            width: 90px;
            height: 35px;
            border: 3px solid #8B4513;
            border-bottom: none;
            border-radius: 35px 35px 0 0;
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .weave-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(90deg, transparent, transparent 8px, rgba(90,42,10,0.3) 8px, rgba(90,42,10,0.3) 10px),
                repeating-linear-gradient(0deg, transparent, transparent 8px, rgba(90,42,10,0.3) 8px, rgba(90,42,10,0.3) 10px);
            border-radius: 10px 10px 30px 30px;
        }
        
        .score-board {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: confettiFall 3s ease-in-out forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes ballPop {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.3);
                opacity: 0.8;
            }
            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        .ball-string {
            position: absolute;
            width: 2px;
            background: linear-gradient(to bottom, #666, transparent);
            transform: translateX(-50%);
            z-index: 1;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0">
  <div class="game-container w-full h-full flex flex-col"><div id="start-screen" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 25px; box-shadow: 0 15px 50px rgba(0,0,0,0.3); text-align: center; z-index: 2000; width: 90%; max-width: 600px; max-height: 90%; overflow-y: auto;">
    <h2 style="font-size: 42px; color: #7c3aed; margin-bottom: 20px; font-family: system-ui, sans-serif; font-weight: bold;">ğŸˆ TRÃ’ CHÆ I Báº®T BÃ“NG</h2><div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%); padding: 20px; border-radius: 15px; margin-bottom: 25px; text-align: left;">
     <h3 style="font-size: 20px; color: #7c3aed; margin-bottom: 12px; font-family: system-ui, sans-serif; font-weight: bold; text-align: center;">ğŸ“– CÃ¡ch ChÆ¡i</h3>
     <ul style="font-size: 15px; color: #374151; margin: 0; padding-left: 25px; font-family: system-ui, sans-serif; line-height: 1.8;">
      <li>ğŸ¯ BÃ³ng rÆ¡i xuá»‘ng tá»« trÃªn cao chá»©a cÃ¡c lá»‡nh Python</li>
      <li>âœ… Báº¥m <strong style="color: #10b981;">"THÃŠM VÃ€O GIá»"</strong> náº¿u cÃ´ng thá»©c <strong>ÄÃšNG</strong></li>
      <li>ğŸ’¥ Báº¥m <strong style="color: #ef4444;">"Äáº¬P BÃ“NG"</strong> náº¿u cÃ´ng thá»©c <strong>SAI</strong></li>
      <li>ğŸ® ThÃªm vÃ o giá» Ä‘Ãºng: <strong style="color: #10b981;">+10 Ä‘iá»ƒm</strong> | ThÃªm vÃ o giá» sai: <strong style="color: #ef4444;">-10 Ä‘iá»ƒm</strong></li>
      <li>ğŸ’¥ Äáº­p bÃ³ng: KhÃ´ng cá»™ng, khÃ´ng trá»« Ä‘iá»ƒm</li>
      <li>â±ï¸ Thá»i gian: <strong>3 phÃºt</strong> - 20 quáº£ bÃ³ng</li>
      <li>ğŸ† Äáº¡t â‰¥80 Ä‘iá»ƒm Ä‘á»ƒ nháº­n quÃ  xuáº¥t sáº¯c!</li>
     </ul>
    </div><button id="start-game-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 20px 50px; font-size: 24px; border-radius: 15px; cursor: pointer; font-weight: bold; font-family: system-ui, sans-serif; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5); transition: transform 0.2s;">â–¶ï¸ Báº¯t Äáº§u ChÆ¡i</button>
   </div>
   <div class="score-board m-4 p-4" style="display: none;">
    <h1 id="game-title" class="text-3xl font-bold text-purple-700 text-center mb-2">TrÃ² ChÆ¡i Báº¯t BÃ³ng</h1>
    <div class="flex justify-around items-center flex-wrap gap-2">
     <div class="text-center"><span id="score-label" class="text-lg font-semibold text-gray-700">Äiá»ƒm: </span> <span id="score" class="text-2xl font-bold text-purple-600">0</span>
     </div>
     <div class="text-center"><span class="text-lg font-semibold text-gray-700">ğŸ¯ BÃ³ng: </span> <span id="ball-counter" class="text-2xl font-bold text-orange-600">1/20</span>
     </div>
    </div>
   </div>
   <div id="game-area" class="flex-1 relative" style="display: none;">
    <div id="basket" class="basket">
     <div class="basket-handle"></div>
     <div class="basket-body">
      <div class="weave-pattern"></div>
     </div>
    </div><div id="timer" style="position: absolute; top: 20px; right: 20px; background: white; padding: 15px 25px; border-radius: 15px; font-size: 28px; font-weight: bold; color: #7c3aed; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
     â±ï¸ <span id="time-left">3:00</span>
    </div><div style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 20px; justify-content: center; align-items: center;"><button id="add-to-basket-btn" style="
                    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                    color: white;
                    border: none;
                    padding: 15px 30px;
                    font-size: 18px;
                    border-radius: 12px;
                    cursor: pointer;
                    font-weight: bold;
                    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
                    transition: all 0.2s;
                    font-family: system-ui, sans-serif;
                    white-space: nowrap;
                ">âœ… THÃŠM VÃ€O GIá»</button> <button id="skip-btn" style="
                    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                    color: white;
                    border: none;
                    padding: 15px 30px;
                    font-size: 18px;
                    border-radius: 12px;
                    cursor: pointer;
                    font-weight: bold;
                    box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
                    transition: all 0.2s;
                    font-family: system-ui, sans-serif;
                    white-space: nowrap;
                ">ğŸ’¥ Äáº¬P BÃ“NG</button>
    </div>
   </div>
  </div>
  <script>
        const defaultConfig = {
            game_title: "TRÃ’ CHÆ I Báº®T BÃ“NG",
            score_label: "Äiá»ƒm: ",
            primary_color: "#667eea",
            secondary_color: "#764ba2",
            text_color: "#5b21b6",
            basket_color: "#8B4513",
            correct_color: "#10b981",
            incorrect_color: "#ef4444",
            font_family: "system-ui",
            font_size: 16
        };

        let config = { ...defaultConfig };
        
        // Danh sÃ¡ch 20 cÃ¢u há»i (10 Ä‘Ãºng, 10 sai)
        const questions = [
            // 10 cÃ¢u ÄÃšNG
            { text: "print('Hi')\nâ†’ Hiá»ƒn thá»‹ Hi", correct: true },
            { text: "input('TÃªn?')\nâ†’ Nháº­p dá»¯ liá»‡u", correct: true },
            { text: "float(13+1)\n->hiá»ƒn thá»‹ 14.0", correct: true },
            { text: "10 != 3+7\nâ†’ False", correct: true },
            { text: "str(120)\n= '120'", correct: true },
            { text: "print(5+3)\nâ†’ Hiá»ƒn thá»‹ 8", correct: true },
            { text: "n=int(input())\nâ†’ Nháº­p sá»‘ n", correct: true },
            { text: "'abc' * 2\n-> hiá»ƒn thá»‹ 'abcabc'", correct: true },
            { text: "20 % 6\n-> 2", correct: true },
            { text: "bool(0)\nâ†’ False", correct: true },
            
            // 10 cÃ¢u SAI
            { text: "print('Hi')\n== 'Hi'", correct: false },
            { text: "input('TÃªn?')\nâ†’ Hiá»ƒn thá»‹: TÃªn?", correct: false },
            { text: "int('42')\n-> hiá»ƒn thá»‹ '42'", correct: false },
            { text: "5 > 0\nâ†’ False", correct: false },
            { text: "print(10)\n= 10", correct: false },
            { text: "str(100)\n= 100", correct: false },
            { text: "input()\nâ†’ Hiá»ƒn thá»‹ text", correct: false },
            { text: "10 - 4\n -> káº¿t quáº£: 7", correct: false },
            { text: "3 ** 2\n-> káº¿t quáº£: 6", correct: false },
            { text: "bool(1)\nâ†’ False", correct: false }
        ];

        let score = 0;
        let currentBallIndex = 0;
        let shuffledQuestions = [];
        let currentBall = null;
        let ballFallInterval = null;
        let isGameOver = false;
        let ballY = 50;
        let fallSpeed = 0.8;
        let basketX = 0;
        let timeLeft = 180;
        let timerInterval = null;
        let backgroundMusic = null;

        const gameArea = document.getElementById('game-area');
        const scoreDisplay = document.getElementById('score');
        const ballCounterDisplay = document.getElementById('ball-counter');
        const timeLeftDisplay = document.getElementById('time-left');

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timeLeftDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                endGame();
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                if (!isGameOver) {
                    timeLeft--;
                    updateTimer();
                }
            }, 1000);
        }

        function createBall(question) {
            const gameWidth = gameArea.offsetWidth;
            // TÄƒng kÃ­ch thÆ°á»›c bÃ³ng tá»« 140 lÃªn 190
            const ballSize = 190;
            
            const ballString = document.createElement('div');
            ballString.className = 'ball-string';
            ballString.style.left = (gameWidth / 2) + 'px';
            ballString.style.height = '50px';
            gameArea.appendChild(ballString);
            
            const ballElement = document.createElement('div');
            ballElement.className = 'ball';
            ballElement.style.left = ((gameWidth - ballSize) / 2) + 'px';
            ballElement.style.top = '50px';
            ballElement.style.width = ballSize + 'px';
            ballElement.style.height = ballSize + 'px';
            // TÄƒng cá»¡ chá»¯ tá»« 17px lÃªn 22px
            ballElement.style.fontSize = '22px';
            
            // MÃ u sáº¯c ngáº«u nhiÃªn cho bÃ³ng
            const ballColors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dfe6e9', '#a29bfe', '#fd79a8'];
            ballElement.style.backgroundColor = ballColors[Math.floor(Math.random() * ballColors.length)];
            
            ballElement.style.color = '#1f2937';
            ballElement.style.lineHeight = '1.4';
            ballElement.textContent = question.text;
            
            // ThÃªm nÃºm bÃ³ng
            const ballKnot = document.createElement('div');
            ballKnot.className = 'ball-knot';
            ballElement.appendChild(ballKnot);
            
            gameArea.appendChild(ballElement);
            
            ballY = 50;
            
            return {
                element: ballElement,
                string: ballString,
                question: question
            };
        }

        function nextBall() {
            if (currentBallIndex >= shuffledQuestions.length || timeLeft <= 0) {
                endGame();
                return;
            }
            
            const question = shuffledQuestions[currentBallIndex];
            currentBall = createBall(question);
            
            ballCounterDisplay.textContent = `${currentBallIndex + 1}/20`;
            
            // BÃ³ng xuáº¥t hiá»‡n tá»« tá»« rÆ¡i xuá»‘ng vÃ  dá»«ng háº³n ngang giá»
            const basket = document.getElementById('basket');
            const basketRect = basket.getBoundingClientRect();
            const gameRect = gameArea.getBoundingClientRect();
            const stopPosition = basketRect.top - gameRect.top - 50; // Äiá»u chá»‰nh vá»‹ trÃ­ dá»«ng cho bÃ³ng to
            
            ballFallInterval = setInterval(() => {
                if (!currentBall || isGameOver) {
                    clearInterval(ballFallInterval);
                    return;
                }
                
                ballY += fallSpeed;
                currentBall.element.style.top = ballY + 'px';
                currentBall.string.style.height = ballY + 'px';
                
                // Dá»«ng bÃ³ng hoÃ n toÃ n khi Ä‘áº¿n ngang giá», chá» ngÆ°á»i chÆ¡i quyáº¿t Ä‘á»‹nh
                if (ballY >= stopPosition) {
                    ballY = stopPosition; // Cá»‘ Ä‘á»‹nh vá»‹ trÃ­
                    currentBall.element.style.top = stopPosition + 'px';
                    currentBall.string.style.height = stopPosition + 'px';
                    clearInterval(ballFallInterval);
                    ballFallInterval = null;
                }
            }, 20);
        }

        function handleAddToBasket() {
            if (!currentBall || isGameOver) return;
            
            clearInterval(ballFallInterval);
            
            // NgÆ°á»i chÆ¡i chá»n thÃªm vÃ o giá»
            if (currentBall.question.correct) {
                // ÄÃºng: cÃ´ng thá»©c Ä‘Ãºng vÃ  chá»n thÃªm vÃ o giá»
                score += 10;
                playSound('correct');
                showFeedback(true);
            } else {
                // Sai: cÃ´ng thá»©c sai nhÆ°ng chá»n thÃªm vÃ o giá»
                score -= 10;
                playSound('wrong');
                showFeedback(false);
            }
            
            updateScoreDisplay();
            animateBallToBasket();
        }

        function handleSkip() {
            if (!currentBall || isGameOver) return;
            
            clearInterval(ballFallInterval);
            
            // NgÆ°á»i chÆ¡i chá»n Ä‘áº­p bÃ³ng - khÃ´ng cá»™ng khÃ´ng trá»« Ä‘iá»ƒm
            playSound('pop');
            
            updateScoreDisplay();
            animateBallPop();
        }

        function animateBallToBasket() {
            const basket = document.getElementById('basket');
            const basketRect = basket.getBoundingClientRect();
            const gameRect = gameArea.getBoundingClientRect();
            
            const targetX = basketRect.left + basketRect.width / 2 - gameRect.left - 95; // CÄƒn chá»‰nh láº¡i cho bÃ³ng to
            const targetY = basketRect.top - gameRect.top;
            
            currentBall.element.style.transition = 'all 0.5s ease-in';
            currentBall.element.style.left = targetX + 'px';
            currentBall.element.style.top = targetY + 'px';
            currentBall.element.style.transform = 'scale(0.3)';
            currentBall.element.style.opacity = '0.5';
            
            setTimeout(() => {
                if (currentBall) {
                    currentBall.element.remove();
                    currentBall.string.remove();
                    currentBall = null;
                    currentBallIndex++;
                    nextBall();
                }
            }, 600);
        }

        function animateBallPop() {
            // Hiá»‡u á»©ng bÃ³ng vá»¡
            currentBall.element.style.animation = 'ballPop 0.5s ease-out forwards';
            
            // Táº¡o cÃ¡c máº£nh vá»¡ bay ra
            const colors = ['#ff6b6b', '#4ecdc4', '#ffeaa7', '#a29bfe'];
            for (let i = 0; i < 12; i++) { // TÄƒng sá»‘ máº£nh vá»¡ cho bÃ³ng to
                const piece = document.createElement('div');
                piece.style.cssText = `
                    position: absolute;
                    width: 20px;
                    height: 20px;
                    border-radius: 50%;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${currentBall.element.offsetLeft + 95}px;
                    top: ${currentBall.element.offsetTop + 95}px;
                    transition: all 0.6s ease-out;
                `;
                gameArea.appendChild(piece);
                
                setTimeout(() => {
                    const angle = (Math.PI * 2 * i) / 12;
                    const distance = 120 + Math.random() * 60;
                    piece.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`;
                    piece.style.opacity = '0';
                }, 50);
                
                setTimeout(() => piece.remove(), 700);
            }
            
            setTimeout(() => {
                if (currentBall) {
                    currentBall.element.remove();
                    currentBall.string.remove();
                    currentBall = null;
                    currentBallIndex++;
                    nextBall();
                }
            }, 600);
        }

        function showFeedback(isCorrect) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 64px;
                font-weight: bold;
                z-index: 1000;
                animation: fadeOut 1s forwards;
            `;
            feedback.textContent = isCorrect ? 'âœ…' : 'âŒ';
            gameArea.appendChild(feedback);
            
            setTimeout(() => feedback.remove(), 1000);
        }

        function updateScoreDisplay() {
            scoreDisplay.textContent = score;
        }
        
        function playSound(type) {
            let soundFile = '';
            if (type === 'correct') {
                soundFile = 'assets/correct_answer.mp3';
            } else if (type === 'wrong') {
                soundFile = 'assets/wrong_answer.mp3';
            } else if (type === 'pop') {
                soundFile = 'assets/ball_pop.mp3';
            } else if (type === 'celebrate') {
                soundFile = 'assets/celebration.mp3';
            }
            
            if (soundFile) {
                const audio = new Audio(soundFile);
                audio.play().catch(e => console.log('KhÃ´ng thá»ƒ phÃ¡t Ã¢m thanh:', e));
            }
        }

        function startBackgroundMusic() {
            backgroundMusic = new Audio('assets/background_music.mp3');
            backgroundMusic.loop = true;
            backgroundMusic.volume = 0.3;
            backgroundMusic.play().catch(e => console.log('KhÃ´ng thá»ƒ phÃ¡t nháº¡c:', e));
        }

        function stopBackgroundMusic() {
            if (backgroundMusic) {
                backgroundMusic.pause();
                backgroundMusic.currentTime = 0;
            }
        }

        function endGame() {
            isGameOver = true;
            clearInterval(ballFallInterval);
            clearInterval(timerInterval);
            stopBackgroundMusic();
            
            if (currentBall) {
                currentBall.element.remove();
                currentBall.string.remove();
            }
            
            const endScreen = document.createElement('div');
            endScreen.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 40px;
                border-radius: 20px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                text-align: center;
                z-index: 1000;
                width: 90%;
                max-width: 500px;
                max-height: 90%;
                overflow-y: auto;
            `;
            
            let rating = '';
            let isExcellent = false;
            if (score >= 80) {
                rating = 'ğŸ† XUáº¤T Sáº®C!';
                isExcellent = true;
            }
            else if (score >= 60) rating = 'â­Báº¡n giá»i Láº¯m!';
            else if (score >= 40) rating = 'ğŸ‘ KhÃ¡ Tá»‘t!';
            else if (score >= 0) rating = 'ğŸ“š Cáº§n Ã”n Táº­p!';
            else rating = 'ğŸ’ª Cá»‘ Gáº¯ng ThÃªm!';
            
            if (isExcellent) {
                createConfetti();
                playSound('celebrate');
                
                // Hiá»ƒn thá»‹ mÃ n hÃ¬nh chá»n quÃ 
                endScreen.innerHTML = `
                    <h2 style="font-size: 36px; color: #7c3aed; margin-bottom: 20px; font-family: ${config.font_family}, system-ui, sans-serif; font-weight: bold;">ğŸ† ${rating}</h2>
                    <p style="font-size: 24px; color: #4b5563; margin-bottom: 20px; font-family: ${config.font_family}, system-ui, sans-serif;">Äiá»ƒm Sá»‘: <strong style="color: #7c3aed; font-size: 32px;">${score}</strong></p>
                    <div style="background: linear-gradient(135deg, #fff5e1 0%, #ffe5e5 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <h3 style="font-size: 22px; color: #ff6b6b; margin-bottom: 15px; font-family: ${config.font_family}, system-ui, sans-serif; font-weight: bold;">ğŸ Chá»n Giá» QuÃ  Cá»§a Báº¡n:</h3>
                        <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                            <button class="gift-basket-btn" data-gift="1" style="
                                background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
                                color: white;
                                border: none;
                                width: 120px;
                                height: 120px;
                                font-size: 50px;
                                border-radius: 15px;
                                cursor: pointer;
                                box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
                                transition: transform 0.2s;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">ğŸ§º</button>
                            
                            <button class="gift-basket-btn" data-gift="2" style="
                                background: linear-gradient(135deg, #4ecdc4 0%, #44a8a8 100%);
                                color: white;
                                border: none;
                                width: 120px;
                                height: 120px;
                                font-size: 50px;
                                border-radius: 15px;
                                cursor: pointer;
                                box-shadow: 0 6px 20px rgba(78, 205, 196, 0.5);
                                transition: transform 0.2s;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">ğŸ§º</button>
                            
                            <button class="gift-basket-btn" data-gift="3" style="
                                background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
                                color: white;
                                border: none;
                                width: 120px;
                                height: 120px;
                                font-size: 50px;
                                border-radius: 15px;
                                cursor: pointer;
                                box-shadow: 0 6px 20px rgba(162, 155, 254, 0.5);
                                transition: transform 0.2s;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">ğŸ§º</button>
                        </div>
                    </div>
                    <div id="gift-result" style="display: none; font-size: 20px; color: #10b981; margin-bottom: 20px; font-family: ${config.font_family}, system-ui, sans-serif; font-weight: bold; padding: 20px; background: #f0fdf4; border-radius: 12px; border: 2px solid #10b981;"></div>
                    <button id="restart-btn" style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        padding: 15px 40px;
                        font-size: 20px;
                        border-radius: 10px;
                        cursor: pointer;
                        font-weight: bold;
                        font-family: ${config.font_family}, system-ui, sans-serif;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                        display: none;
                    ">ğŸ”„ ChÆ¡i Láº¡i</button>
                `;
                gameArea.appendChild(endScreen);
                
                // Xá»­ lÃ½ chá»n giá» quÃ 
                const giftButtons = endScreen.querySelectorAll('.gift-basket-btn');
                giftButtons.forEach(btn => {
                    btn.addEventListener('mouseenter', function() {
                        this.style.transform = 'scale(1.1) rotate(5deg)';
                    });
                    btn.addEventListener('mouseleave', function() {
                        this.style.transform = 'scale(1) rotate(0deg)';
                    });
                    btn.addEventListener('click', function() {
                        const giftType = this.getAttribute('data-gift');
                        let giftMessage = '';
                        
                        if (giftType === '1') {
                            giftMessage = 'ğŸ‰ ChÃºc má»«ng báº¡n Ä‘Ã£ Ä‘Æ°á»£c:<br/><strong style="font-size: 24px;">ğŸ‘ Má»™t trÃ ng vá»— tay tá»« cÃ¡c báº¡n trong lá»›p!</strong>';
                        } else if (giftType === '2') {
                            giftMessage = 'ğŸ‰ ChÃºc má»«ng báº¡n Ä‘Ã£ Ä‘Æ°á»£c:<br/><strong style="font-size: 24px;">ğŸµ ÄÆ°á»£c táº·ng má»™t bÃ i hÃ¡t tá»« má»™t báº¡n chá»‰ Ä‘á»‹nh hÃ¡t!</strong>';
                        } else if (giftType === '3') {
                            giftMessage = 'ğŸ‰ ChÃºc má»«ng báº¡n Ä‘Ã£ Ä‘Æ°á»£c:<br/><strong style="font-size: 24px;">â­ ÄÆ°á»£c cá»™ng 1 Ä‘iá»ƒm vÃ o Ä‘iá»ƒm thÆ°á»ng xuyÃªn tá»« cÃ´ Nhung!</strong>';
                        }
                        
                        document.getElementById('gift-result').innerHTML = giftMessage;
                        document.getElementById('gift-result').style.display = 'block';
                        document.getElementById('restart-btn').style.display = 'block';
                        
                        giftButtons.forEach(b => b.disabled = true);
                        giftButtons.forEach(b => b.style.opacity = '0.3');
                        
                        // Hiá»‡u á»©ng phÃ¡o hoa cho giá» Ä‘Æ°á»£c chá»n
                        this.style.transform = 'scale(1.3)';
                        this.style.opacity = '1';
                    });
                });
                
                document.getElementById('restart-btn').addEventListener('click', () => {
                    endScreen.remove();
                    restartGame();
                });
            } else {
                // MÃ n hÃ¬nh thÆ°á»ng cho Ä‘iá»ƒm khÃ´ng xuáº¥t sáº¯c
                endScreen.innerHTML = `
                    <h2 style="font-size: 36px; color: #7c3aed; margin-bottom: 20px; font-family: ${config.font_family}, system-ui, sans-serif; font-weight: bold;">${rating}</h2>
                    <p style="font-size: 24px; color: #4b5563; margin-bottom: 30px; font-family: ${config.font_family}, system-ui, sans-serif;">Äiá»ƒm Sá»‘: <strong style="color: #7c3aed; font-size: 32px;">${score}</strong></p>
                    <button id="restart-btn" style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        padding: 15px 40px;
                        font-size: 20px;
                        border-radius: 10px;
                        cursor: pointer;
                        font-weight: bold;
                        font-family: ${config.font_family}, system-ui, sans-serif;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                    ">ğŸ”„ ChÆ¡i Láº¡i</button>
                `;
                gameArea.appendChild(endScreen);
                
                document.getElementById('restart-btn').addEventListener('click', () => {
                    endScreen.remove();
                    restartGame();
                });
            }
        }
        
        function createConfetti() {
            const colors = ['#fbbf24', '#f59e0b', '#ef4444', '#10b981', '#3b82f6', '#8b5cf6'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    gameArea.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }

        function restartGame() {
            score = 0;
            currentBallIndex = 0;
            isGameOver = false;
            timeLeft = 180;
            shuffledQuestions = shuffleArray(questions);
            
            document.getElementById('start-screen').style.display = 'block';
            document.querySelector('.score-board').style.display = 'none';
            document.getElementById('game-area').style.display = 'none';
            
            scoreDisplay.textContent = score;
            ballCounterDisplay.textContent = '1/20';
            timeLeftDisplay.textContent = '3:00';
        }

        function startGame() {
            shuffledQuestions = shuffleArray(questions);
            startTimer();
            startBackgroundMusic();
            nextBall();
        }

        function createFallingDecorations() {
            const decorations = ['ğŸŒ¸', 'ğŸŒº', 'ğŸŒ¼', 'ğŸŒ»', 'ğŸŒ·', 'ğŸƒ', 'ğŸŒ¿', 'ğŸŒ·'];
            const container = document.querySelector('.game-container');
            
            setInterval(() => {
                const decoration = document.createElement('div');
                decoration.className = 'falling-decoration';
                decoration.textContent = decorations[Math.floor(Math.random() * decorations.length)];
                decoration.style.left = Math.random() * 100 + '%';
                decoration.style.animationDuration = (Math.random() * 5 + 5) + 's';
                decoration.style.fontSize = (Math.random() * 15 + 15) + 'px';
                container.appendChild(decoration);
                
                setTimeout(() => decoration.remove(), 15000);
            }, 800);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const basket = document.getElementById('basket');
            
            createFallingDecorations();
            
            document.getElementById('start-game-btn').addEventListener('click', () => {
                document.getElementById('start-screen').style.display = 'none';
                document.querySelector('.score-board').style.display = 'block';
                document.getElementById('game-area').style.display = 'block';
                
                startGame();
            });
            
            document.getElementById('add-to-basket-btn').addEventListener('click', handleAddToBasket);
            document.getElementById('skip-btn').addEventListener('click', handleSkip);
            
            document.getElementById('add-to-basket-btn').addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05)';
            });
            document.getElementById('add-to-basket-btn').addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
            
            document.getElementById('skip-btn').addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05)';
            });
            document.getElementById('skip-btn').addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        });

        async function onConfigChange(newConfig) {
            config = { ...config, ...newConfig };
            
            document.getElementById('game-title').textContent = config.game_title;
            document.getElementById('score-label').textContent = config.score_label;
            
            const container = document.querySelector('.game-container');
            container.style.background = '#ffffff';
            
            const titleElement = document.getElementById('game-title');
            titleElement.style.color = config.text_color;
            titleElement.style.fontFamily = `${config.font_family}, system-ui, sans-serif`;
            titleElement.style.fontSize = `${config.font_size * 1.875}px`;
            
            const scoreLabelElement = document.getElementById('score-label');
            scoreLabelElement.style.fontFamily = `${config.font_family}, system-ui, sans-serif`;
            scoreLabelElement.style.fontSize = `${config.font_size * 1.125}px`;
            
            const scoreElement = document.getElementById('score');
            scoreElement.style.fontFamily = `${config.font_family}, system-ui, sans-serif`;
            scoreElement.style.fontSize = `${config.font_size * 1.5}px`;
            
            const basketBody = document.querySelector('.basket-body');
            basketBody.style.background = `linear-gradient(to bottom, ${config.basket_color} 0%, ${adjustBrightness(config.basket_color, -20)} 100%)`;
            
            const basketHandle = document.querySelector('.basket-handle');
            basketHandle.style.borderColor = config.basket_color;
        }

        function adjustBrightness(color, percent) {
            const num = parseInt(color.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = Math.max(0, Math.min(255, (num >> 16) + amt));
            const G = Math.max(0, Math.min(255, (num >> 8 & 0x00FF) + amt));
            const B = Math.max(0, Math.min(255, (num & 0x0000FF) + amt));
            return '#' + (0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1);
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.primary_color,
                        set: (value) => {
                            config.primary_color = value;
                            window.elementSdk.setConfig({ primary_color: value });
                        }
                    },
                    {
                        get: () => config.secondary_color,
                        set: (value) => {
                            config.secondary_color = value;
                            window.elementSdk.setConfig({ secondary_color: value });
                        }
                    },
                    {
                        get: () => config.text_color,
                        set: (value) => {
                            config.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    },
                    {
                        get: () => config.basket_color,
                        set: (value) => {
                            config.basket_color = value;
                            window.elementSdk.setConfig({ basket_color: value });
                        }
                    },
                    {
                        get: () => config.correct_color,
                        set: (value) => {
                            config.correct_color = value;
                            window.elementSdk.setConfig({ correct_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family,
                    set: (value) => {
                        config.font_family = value;
                        window.elementSdk.setConfig({ font_family: value });
                    }
                },
                fontSizeable: {
                    get: () => config.font_size,
                    set: (value) => {
                        config.font_size = value;
                        window.elementSdk.setConfig({ font_size: value });
                    }
                }
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["game_title", config.game_title],
                ["score_label", config.score_label]
            ]);
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        window.addEventListener('load', () => {
            onConfigChange(defaultConfig);
        });
    </script>
 </body>
</html>
